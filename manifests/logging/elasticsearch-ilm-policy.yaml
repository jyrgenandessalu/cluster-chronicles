apiVersion: v1
kind: ConfigMap
metadata:
  name: elasticsearch-ilm-policy
  labels:
    app: elasticsearch
    component: ilm
data:
  ilm-policy.json: |
    {
      "policy": {
        "phases": {
          "hot": {
            "min_age": "0ms",
            "actions": {
              "rollover": {
                "max_size": "10GB",
                "max_age": "1d"
              },
              "set_priority": {
                "priority": 100
              }
            }
          },
          "warm": {
            "min_age": "7d",
            "actions": {
              "set_priority": {
                "priority": 50
              },
              "allocate": {
                "number_of_replicas": 0
              }
            }
          },
          "delete": {
            "min_age": "30d",
            "actions": {
              "delete": {}
            }
          }
        }
      }
    }
  index-template.json: |
    {
      "index_patterns": ["kubernetes-logs-*"],
      "template": {
        "settings": {
          "number_of_shards": 1,
          "number_of_replicas": 0,
          "index.lifecycle.name": "kubernetes-logs-policy",
          "index.lifecycle.rollover_alias": "kubernetes-logs"
        },
        "mappings": {
          "properties": {
            "@timestamp": {
              "type": "date"
            },
            "log": {
              "type": "text"
            },
            "kubernetes": {
              "properties": {
                "pod_name": {
                  "type": "keyword"
                },
                "namespace_name": {
                  "type": "keyword"
                },
                "container_name": {
                  "type": "keyword"
                }
              }
            }
          }
        }
      }
    }

